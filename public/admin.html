<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç½‘ç«™ç®¡ç† - æ¸…æº</title>
    <style>
        :root{
            --bg:#0b0f14;
            --card:#121821;
            --txt:#e6edf3;
            --muted:#9fb3c8;
            --pri:#5aa9ff;
            --accent:#7c4dff;
            --base-size: 1rem;
            --scale-mobile: 0.875;
            --scale-tablet: 0.9375;
            --scale-desktop: 1;
            --sidebar-bg: #1a1f2e;
            --sidebar-border: #2a3442;
            --content-bg: #0f151d;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            font-size: 16px;
        }
        
        body {
            font-family: system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(180deg, #0b0f14, #0e141b);
            color: var(--txt);
            min-height: 100vh;
            font-size: var(--base-size);
            overflow-x: hidden;
        }
        
        .admin-layout {
            display: flex;
            min-height: 100vh;
            background: var(--bg);
        }
        
        /* å·¦ä¾§å¯¼èˆªæ  */
        .sidebar {
            width: 280px;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--sidebar-border);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }
        
        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--sidebar-border);
        }
        
        .sidebar-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--pri);
            margin-bottom: 0.5rem;
        }
        
        .sidebar-subtitle {
            color: var(--muted);
            font-size: 0.9rem;
        }
        
        
        .sidebar-nav {
            flex: 1;
            padding: 1rem 0;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: var(--muted);
            text-decoration: none;
            transition: all 0.2s ease;
            cursor: pointer;
            border-left: 3px solid transparent;
        }
        
        .nav-item:hover {
            background: rgba(90, 169, 255, 0.1);
            color: var(--txt);
        }
        
        .nav-item.active {
            background: rgba(90, 169, 255, 0.15);
            color: var(--pri);
            border-left-color: var(--pri);
        }
        
        .nav-item-icon {
            width: 20px;
            height: 20px;
            margin-right: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .nav-item-text {
            flex: 1;
            font-weight: 500;
        }
        
        .sidebar-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--sidebar-border);
        }
        
        .feedback-btn {
            width: 100%;
            padding: 0.5rem;
            background: transparent;
            border: 1px solid var(--sidebar-border);
            border-radius: 0.375rem;
            color: var(--muted);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .feedback-btn:hover {
            background: rgba(90, 169, 255, 0.1);
            color: var(--txt);
        }
        
        /* å³ä¾§å†…å®¹åŒºåŸŸ */
        .main-content {
            flex: 1;
            margin-left: 280px;
            background: var(--content-bg);
            min-height: 100vh;
        }
        
        .content-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--sidebar-border);
            background: var(--card);
        }
        
        .content-title {
            font-size: 1.75rem;
            font-weight: 600;
            color: var(--txt);
            margin-bottom: 0.5rem;
        }
        
        .content-description {
            color: var(--muted);
            font-size: 0.95rem;
        }
        
        .content-body {
            padding: 2rem;
        }
        
        .content-section {
            margin-bottom: 2rem;
        }
        
        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--txt);
            margin-bottom: 1rem;
        }
        
        /* é¡µé¢å†…å®¹åˆ‡æ¢ */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* å¡ç‰‡æ ·å¼ */
        .card {
            background: var(--card);
            border: 1px solid var(--sidebar-border);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--txt);
        }
        
        .card-description {
            color: var(--muted);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            text-align: center;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        /* å¿«é€Ÿæ“ä½œæŒ‰é’® */
        .quick-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .quick-action-btn {
            padding: 0.75rem 1.5rem !important;
            border: 1px solid var(--sidebar-border) !important;
            border-radius: 0.5rem !important;
            background: var(--card) !important;
            color: var(--txt) !important;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            flex: 1;
            min-width: 120px;
            text-align: center;
            white-space: nowrap;
            font-size: 0.9rem !important;
        }
        
        .quick-action-btn:hover {
            background: rgba(90, 169, 255, 0.1) !important;
            border-color: var(--pri) !important;
            color: var(--pri) !important;
        }
        
        .section {
            margin-bottom: 1.875rem;
        }
        
        .info-tip {
            background: linear-gradient(135deg, #1e3a8a, #1e40af);
            border: 1px solid #3b82f6;
            border-radius: 0.75rem;
            padding: 1rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }
        
        .tip-icon {
            font-size: 1.25rem;
            flex-shrink: 0;
            margin-top: 0.125rem;
        }
        
        .tip-content {
            color: #e0e7ff;
            line-height: 1.5;
            font-size: 0.9rem;
        }
        
        .tip-content strong {
            color: #fbbf24;
        }
        
        .section h3 {
            color: #2c3e50;
            margin-bottom: 0.9375rem;
            font-size: 1.3rem;
        }
        
        .site-list {
            background: rgba(15, 21, 29, 0.6);
            border: 1px solid #2a3442;
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin-bottom: 1.25rem;
            backdrop-filter: blur(5px);
        }
        
        .site-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.125rem;
            background: linear-gradient(135deg, rgba(15, 21, 29, 0.8), rgba(18, 24, 33, 0.6));
            border: 1px solid #2a3442;
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
            box-shadow: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }
        
        .site-item:hover {
            transform: translateY(-0.125rem);
            box-shadow: 0 0.5rem 1.25rem rgba(0, 0, 0, 0.4);
            border-color: #3a4552;
        }
        
        .site-info {
            flex: 1;
        }
        
        .site-domain {
            font-weight: 600;
            color: var(--txt);
            margin-bottom: 0.3125rem;
            font-size: var(--base-size);
        }
        
        .site-actions {
            display: flex;
            gap: 0.625rem;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border: 1px solid #2a3442;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            background: var(--card);
            color: var(--txt);
            font-weight: 500;
            box-shadow: none;
            white-space: nowrap;
        }
        
        .btn-primary {
            background: var(--card);
            color: var(--txt);
            border-color: #2a3442;
        }
        
        .btn-danger {
            background: var(--card);
            color: var(--txt);
            border-color: #2a3442;
        }
        
        .btn-success {
            background: var(--card);
            color: var(--txt);
            border-color: #2a3442;
        }
        
        .btn-warning {
            background: var(--card);
            color: var(--txt);
            border-color: #2a3442;
        }
        
        .btn:hover {
            filter: brightness(1.1);
            transform: translateY(-0.0625rem);
        }
        
        /* Toast æç¤ºæ ·å¼ */
        .toast {
            position: fixed;
            top: 1.25rem;
            right: 1.25rem;
            padding: 0.75rem 1.25rem;
            border-radius: 0.5rem;
            color: var(--txt);
            font-weight: 500;
            z-index: 10000;
            transform: translateX(100%);
            transition: all 0.3s ease;
            font-size: var(--base-size);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            max-width: 300px;
        }
        
        .toast.show {
            transform: translateX(0);
        }
        
        .toast.success {
            background: rgba(40, 167, 69, 0.9);
            border: 1px solid #27ae60;
        }
        
        .toast.error {
            background: rgba(220, 53, 69, 0.9);
            border: 1px solid #e74c3c;
        }
        
        .toast.info {
            background: rgba(18, 24, 33, 0.9);
            border: 1px solid #2a3442;
        }
        
        /* èƒŒæ™¯å¤§å­—ä½“ */
        .bg-text {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 120px;
            font-weight: 900;
            color: transparent;
            z-index: 1;
            pointer-events: none;
            user-select: none;
            letter-spacing: 20px;
            opacity: 0.2;
            -webkit-text-stroke: 2px rgba(135, 206, 235, 0.2);
            text-shadow: 0 0 10px rgba(135, 206, 235, 0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--txt);
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #2a3442;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
            background: #0f151d;
            color: var(--txt);
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--pri);
        }
        
        .form-row {
            display: flex;
            gap: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .blacklist-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(220, 53, 69, 0.1);
            border: 1px solid #e74c3c;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
        }
        
        .status-enabled {
            background: rgba(40, 167, 69, 0.2);
            color: #6bcf7f;
            border: 1px solid #27ae60;
        }
        
        .status-disabled {
            background: rgba(220, 53, 69, 0.2);
            color: #ff6b6b;
            border: 1px solid #e74c3c;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }
        
        .error {
            background: rgba(220, 53, 69, 0.2);
            color: #ff6b6b;
            border: 1px solid #e74c3c;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ - ä½¿ç”¨ä¸»é¢˜è‰² */
        ::-webkit-scrollbar {
            width: 0.5rem;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(18, 24, 33, 0.3);
            border-radius: 0.25rem;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, rgba(90, 169, 255, 0.7), rgba(90, 169, 255, 0.5));
            border-radius: 0.25rem;
            border: 1px solid rgba(90, 169, 255, 0.1);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, rgba(90, 169, 255, 0.9), rgba(90, 169, 255, 0.7));
        }
        
        /* ç‰¹å®šå…ƒç´ çš„æ»šåŠ¨æ¡æ ·å¼ */
        #keywords-list::-webkit-scrollbar {
            width: 0.5rem;
        }
        #keywords-list::-webkit-scrollbar-track {
            background: rgba(18, 24, 33, 0.3);
            border-radius: 0.25rem;
        }
        #keywords-list::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, rgba(90, 169, 255, 0.7), rgba(90, 169, 255, 0.5));
            border-radius: 0.25rem;
            border: 1px solid rgba(90, 169, 255, 0.1);
        }
        #keywords-list::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, rgba(90, 169, 255, 0.9), rgba(90, 169, 255, 0.7));
        }
        
        /* ç§»åŠ¨ç«¯å“åº”å¼æ ·å¼ */
        @media (max-width: 768px) {
            html { font-size: 14px; }
            
            .admin-layout {
                flex-direction: column;
            }
            
            .sidebar {
                position: relative;
                width: 100%;
                height: auto;
                border-right: none;
                border-bottom: 1px solid var(--sidebar-border);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .content-body {
                padding: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 0.75rem;
            }
            
            .quick-actions {
                flex-direction: column;
            }
            
            .quick-action-btn {
                width: 100%;
                text-align: center;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .site-item {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            
            .site-actions {
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .btn {
                padding: 0.5rem 0.75rem;
                font-size: 0.8rem;
            }
            
            .toast {
                top: 1rem;
                right: 1rem;
                left: 1rem;
                max-width: none;
            }
        }
        
        @media (max-width: 480px) {
            html{font-size: 13px;}
            
            .container{padding:1rem;margin:0.25rem;}
            .header h1{font-size:1.75rem;}
            .header p{font-size:0.9rem;}
            .tabs{flex-direction:column;gap:0.25rem;}
            .tab{padding:0.625rem 0.75rem;font-size:0.9rem;}
            .section{margin-bottom:1.25rem;}
            .section h3{font-size:1.1rem;}
            .site-list{padding:0.75rem;}
            .site-item{padding:0.75rem;}
            .site-domain{font-size:0.9rem;}
            .btn{padding:0.375rem 0.625rem;font-size:0.75rem;}
            .toast{top:0.75rem;right:0.75rem;left:0.75rem;padding:0.625rem 1rem;font-size:0.8rem;}
        }
        
        @media (max-width: 360px) {
            html{font-size: 12px;}
            
            .container{padding:0.75rem;margin:0.125rem;}
            .header h1{font-size:1.5rem;}
            .header p{font-size:0.8rem;}
            .tabs{flex-direction:column;gap:0.125rem;}
            .tab{padding:0.5rem 0.625rem;font-size:0.8rem;}
            .section{margin-bottom:1rem;}
            .section h3{font-size:1rem;}
            .site-list{padding:0.5rem;}
            .site-item{padding:0.5rem;}
            .site-domain{font-size:0.8rem;}
            .btn{padding:0.25rem 0.5rem;font-size:0.7rem;}
            .toast{top:0.5rem;right:0.5rem;left:0.5rem;padding:0.5rem 0.75rem;font-size:0.75rem;}
        }
        
        /* ç½‘ç«™é€‰æ‹©æ ·å¼ */
        .site-selection {
            border: 1px solid var(--sidebar-border);
            border-radius: 0.5rem;
            background: var(--card);
            padding: 1rem;
        }
        
        .site-selection-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--sidebar-border);
        }
        
        .site-selection-header input[type="checkbox"] {
            margin-right: 0.5rem;
            width: 1rem;
            height: 1rem;
            accent-color: var(--pri);
            cursor: pointer;
        }
        
        .site-selection-header label {
            margin: 0;
            font-weight: 500;
            color: var(--txt);
        }
        
        .selected-count {
            margin-left: auto;
            color: var(--pri);
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .site-checkbox-list {
            max-height: 200px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .site-checkbox-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border: 1px solid var(--sidebar-border);
            border-radius: 0.5rem;
            background: var(--bg);
            transition: all 0.2s ease;
            width: 100%;
        }
        
        .site-checkbox-item:hover {
            background: rgba(90, 169, 255, 0.1);
            border-color: var(--pri);
        }
        
        .site-checkbox-item input[type="checkbox"] {
            margin-right: 0.5rem;
            width: 1rem;
            height: 1rem;
            accent-color: var(--pri);
            cursor: pointer;
        }
        
        .site-checkbox-item label {
            margin: 0;
            flex: 1;
            cursor: pointer;
            color: var(--txt);
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .site-name {
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .site-categories {
            font-size: 0.8rem;
            color: var(--pri);
            opacity: 0.8;
            margin-left: auto;
        }
        
        /* åˆ†ç±»é¡¹ç›®æ ·å¼ */
        .category-item {
            border: 1px solid var(--sidebar-border);
            border-radius: 0.5rem;
            background: var(--card);
            margin-bottom: 1rem;
            overflow: hidden;
        }
        
        .category-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .category-header:hover {
            background: rgba(90, 169, 255, 0.1);
        }
        
        .category-info {
            flex: 1;
        }
        
        .category-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--txt);
            margin-bottom: 0.25rem;
        }
        
        .category-description {
            color: var(--muted);
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }
        
        .category-count {
            color: var(--pri);
            font-size: 0.8rem;
        }
        
        .category-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .expand-icon {
            font-size: 0.8rem;
            color: var(--pri);
            transition: transform 0.2s ease;
            margin-left: 0.5rem;
        }
        
        .category-sites {
            border-top: 1px solid var(--sidebar-border);
            background: var(--bg);
        }
        
        .sites-list {
            padding: 1rem;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .site-in-category {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem;
            border: 1px solid var(--sidebar-border);
            border-radius: 0.25rem;
            background: var(--card);
            margin-bottom: 0.5rem;
        }
        
        .site-in-category:last-child {
            margin-bottom: 0;
        }
        
        .site-in-category .site-domain {
            font-weight: 500;
            color: var(--txt);
        }
        
        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
        }
        
        .add-sites-section {
            padding: 1rem;
            border-top: 1px solid var(--sidebar-border);
            background: var(--bg);
            text-align: center;
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: var(--card);
            border: 1px solid #2a3442;
            border-radius: 0.75rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #2a3442;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            color: var(--pri);
            font-size: 1.25rem;
            margin: 0;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: var(--muted);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.25rem;
        }
        
        .close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--txt);
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .modal-footer {
            padding: 1.25rem 1.5rem;
            border-top: 1px solid #2a3442;
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
        }
        
        .modal-footer .btn {
            padding: 0.5rem 1rem;
        }
        
        .modal textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #2a3442;
            border-radius: 0.375rem;
            background: var(--bg);
            color: var(--txt);
            font-family: inherit;
            resize: vertical;
            min-height: 120px;
        }
        
        .modal textarea:focus {
            outline: none;
            border-color: var(--pri);
        }
        
        /* ç½‘ç«™é€‰é¡¹æ ·å¼ */
        .site-options {
            margin-top: 0.5rem;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: var(--muted);
            cursor: pointer;
        }
        
        .checkbox-label input[type="checkbox"] {
            width: 1rem;
            height: 1rem;
            accent-color: var(--pri);
        }
        
        .checkbox-label span {
            user-select: none;
        }
    </style>
</head>
<body>
    <div class="admin-layout">
        <!-- å·¦ä¾§å¯¼èˆªæ  -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">ç½‘ç«™ç®¡ç†</div>
                <div class="sidebar-subtitle">ç®¡ç†æœç´¢ç½‘ç«™é…ç½®å’Œæœç´¢è®¾ç½®</div>
            </div>
            
            
            <div class="sidebar-nav">
                <div class="nav-item active" data-tab="overview">
                    <div class="nav-item-icon">ğŸ“Š</div>
                    <div class="nav-item-text">æ¦‚è§ˆ</div>
                </div>
                <div class="nav-item" data-tab="web">
                    <div class="nav-item-icon">ğŸŒ</div>
                    <div class="nav-item-text">ç½‘é¡µæœç´¢</div>
                </div>
                <div class="nav-item" data-tab="images">
                    <div class="nav-item-icon">ğŸ–¼ï¸</div>
                    <div class="nav-item-text">å›¾ç‰‡æœç´¢</div>
                </div>
                <div class="nav-item" data-tab="videos">
                    <div class="nav-item-icon">ğŸ¥</div>
                    <div class="nav-item-text">è§†é¢‘æœç´¢</div>
                </div>
                <div class="nav-item" data-tab="resources">
                    <div class="nav-item-icon">ğŸ“</div>
                    <div class="nav-item-text">èµ„æºæœç´¢</div>
                </div>
                <div class="nav-item" data-tab="categories">
                    <div class="nav-item-icon">ğŸ·ï¸</div>
                    <div class="nav-item-text">åˆ†ç±»ç®¡ç†</div>
                </div>
                <div class="nav-item" data-tab="blacklist">
                    <div class="nav-item-icon">ğŸš«</div>
                    <div class="nav-item-text">é»‘åå•</div>
                </div>
                <div class="nav-item" data-tab="settings">
                    <div class="nav-item-icon">âš™ï¸</div>
                    <div class="nav-item-text">è®¾ç½®</div>
                </div>
            </div>
            
            <div class="sidebar-footer">
                <button class="feedback-btn">å‘é€åé¦ˆ</button>
            </div>
        </div>
        
        <!-- å³ä¾§å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <div class="content-header">
                <div class="content-title" id="content-title">æ¦‚è§ˆ</div>
                <div class="content-description" id="content-description">æŸ¥çœ‹ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯å’Œå¿«é€Ÿæ“ä½œ</div>
            </div>
            
            <div class="content-body">
                <!-- æ¦‚è§ˆé¡µé¢ -->
                <div id="overview" class="tab-content active">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="web-count">0</div>
                            <div class="stat-label">ç½‘é¡µç½‘ç«™</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="image-count">0</div>
                            <div class="stat-label">å›¾ç‰‡ç½‘ç«™</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="video-count">0</div>
                            <div class="stat-label">è§†é¢‘ç½‘ç«™</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="resource-count">0</div>
                            <div class="stat-label">èµ„æºç½‘ç«™</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="blacklist-count">0</div>
                            <div class="stat-label">é»‘åå•</div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">å¿«é€Ÿæ“ä½œ</div>
                        </div>
                        <div class="card-description">å¸¸ç”¨çš„ç®¡ç†æ“ä½œï¼Œå¿«é€Ÿæ‰§è¡Œé…ç½®ç®¡ç†ä»»åŠ¡</div>
                        <div class="quick-actions">
                            <button class="quick-action-btn" onclick="refreshData()">åˆ·æ–°æ•°æ®</button>
                            <button class="quick-action-btn" onclick="exportConfig()">å¯¼å‡ºé…ç½®</button>
                            <button class="quick-action-btn" onclick="importConfig()">å¯¼å…¥é…ç½®</button>
                            <button class="quick-action-btn" onclick="resetConfig()">é‡ç½®é…ç½®</button>
                        </div>
                    </div>
                </div>
        
                <!-- ç½‘é¡µæœç´¢é¡µé¢ -->
                <div id="web" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">æ·»åŠ ç½‘é¡µç½‘ç«™</div>
                        </div>
                        <div class="card-description">
                            <strong>æ³¨æ„ï¼š</strong>éƒ¨åˆ†ç½‘ç«™å¯èƒ½ä¼šé‡åˆ°403é”™è¯¯å¯¼è‡´æ— æ³•è®¿é—®ã€‚æœç´¢é€Ÿåº¦ä¸ç»“æœå–å†³äºè®¾ç½®çš„ç½‘ç«™ã€ç½‘é€Ÿå’Œæ‰€åœ¨åœ°åŒºã€‚
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>åŸŸå</label>
                                <input type="text" id="web-domain" placeholder="ä¾‹å¦‚: github.com">
                            </div>
                            <div class="form-group">
                                <label>æœç´¢URLæ¨¡æ¿ï¼ˆå¯é€‰ï¼‰</label>
                                <input type="text" id="web-search-urls" placeholder="ä¾‹å¦‚: https://github.com/search?q={query}ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>å¤åˆ¶æœç´¢é“¾æ¥ï¼ˆè‡ªåŠ¨è§£æï¼‰</label>
                                <input type="text" id="web-copy-url" placeholder="ç²˜è´´ä¸€ä¸ªæœç´¢é“¾æ¥ï¼Œä¾‹å¦‚: https://github.com/search?q=python">
                                <button class="btn btn-secondary" onclick="parseWebUrl()">è§£æé“¾æ¥</button>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="addWebSite()">æ·»åŠ ç½‘ç«™</button>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">ç½‘é¡µç½‘ç«™åˆ—è¡¨</div>
                        </div>
                        <div id="web-sites" class="site-list">
                            <div class="loading">åŠ è½½ä¸­...</div>
                        </div>
                    </div>
                </div>
        
                <!-- å›¾ç‰‡æœç´¢é¡µé¢ -->
                <div id="images" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">æ·»åŠ å›¾ç‰‡ç½‘ç«™</div>
                        </div>
                        <div class="card-description">
                            <strong>æ³¨æ„ï¼š</strong>å›¾ç‰‡æœç´¢ä¼˜å…ˆä½¿ç”¨æœç´¢å¼•æ“çš„å›¾ç‰‡æœç´¢ï¼Œå¦‚æœç»“æœä¸è¶³ä¼šä½¿ç”¨é…ç½®çš„ç½‘ç«™è¡¥å……ã€‚éƒ¨åˆ†ç½‘ç«™å¯èƒ½ä¼šé‡åˆ°403é”™è¯¯å¯¼è‡´æ— æ³•è®¿é—®ã€‚
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>åŸŸå</label>
                                <input type="text" id="image-domain" placeholder="ä¾‹å¦‚: unsplash.com">
                            </div>
                            <div class="form-group">
                                <label>æœç´¢URLæ¨¡æ¿ï¼ˆå¯é€‰ï¼‰</label>
                                <input type="text" id="image-search-urls" placeholder="ä¾‹å¦‚: https://unsplash.com/s/photos/{query}ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>å¤åˆ¶æœç´¢é“¾æ¥ï¼ˆè‡ªåŠ¨è§£æï¼‰</label>
                                <input type="text" id="image-copy-url" placeholder="ç²˜è´´ä¸€ä¸ªæœç´¢é“¾æ¥ï¼Œä¾‹å¦‚: https://unsplash.com/s/photos/nature">
                                <button class="btn btn-secondary" onclick="parseImageUrl()">è§£æé“¾æ¥</button>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="addImageSite()">æ·»åŠ ç½‘ç«™</button>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">å›¾ç‰‡ç½‘ç«™åˆ—è¡¨</div>
                        </div>
                        <div id="image-sites" class="site-list">
                            <div class="loading">åŠ è½½ä¸­...</div>
                        </div>
                    </div>
                </div>
        
                <!-- è§†é¢‘æœç´¢é¡µé¢ -->
                <div id="videos" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">æ·»åŠ è§†é¢‘ç½‘ç«™</div>
                        </div>
                        <div class="card-description">
                            <strong>æ³¨æ„ï¼š</strong>è§†é¢‘æœç´¢ä¸»è¦ä½¿ç”¨æœç´¢å¼•æ“çš„è§†é¢‘æœç´¢åŠŸèƒ½ï¼Œé…ç½®çš„ç½‘ç«™ä¸»è¦ç”¨äºè¡¥å……ã€‚æœç´¢é€Ÿåº¦ä¸ç»“æœå–å†³äºè®¾ç½®çš„ç½‘ç«™ã€ç½‘é€Ÿå’Œæ‰€åœ¨åœ°åŒºã€‚
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>åŸŸå</label>
                                <input type="text" id="video-domain" placeholder="ä¾‹å¦‚: bilibili.com">
                            </div>
                            <div class="form-group">
                                <label>æœç´¢URLæ¨¡æ¿ï¼ˆå¯é€‰ï¼‰</label>
                                <input type="text" id="video-search-urls" placeholder="ä¾‹å¦‚: https://search.bilibili.com/video?keyword={query}ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>å¤åˆ¶æœç´¢é“¾æ¥ï¼ˆè‡ªåŠ¨è§£æï¼‰</label>
                                <input type="text" id="video-copy-url" placeholder="ç²˜è´´ä¸€ä¸ªæœç´¢é“¾æ¥ï¼Œä¾‹å¦‚: https://search.bilibili.com/video?keyword=python">
                                <button class="btn btn-secondary" onclick="parseVideoUrl()">è§£æé“¾æ¥</button>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="addVideoSite()">æ·»åŠ ç½‘ç«™</button>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">è§†é¢‘ç½‘ç«™åˆ—è¡¨</div>
                        </div>
                        <div id="video-sites" class="site-list">
                            <div class="loading">åŠ è½½ä¸­...</div>
                        </div>
                    </div>
                </div>
        
                <!-- èµ„æºæœç´¢é¡µé¢ -->
                <div id="resources" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">æ·»åŠ èµ„æºç½‘ç«™</div>
                        </div>
                        <div class="card-description">
                            <strong>æ³¨æ„ï¼š</strong>èµ„æºæœç´¢ä»…ä½¿ç”¨é…ç½®çš„èµ„æºç½‘ç«™è¿›è¡Œç›´æ¥æœç´¢ã€‚éƒ¨åˆ†ç½‘ç«™å¯èƒ½ä¼šé‡åˆ°403é”™è¯¯å¯¼è‡´æ— æ³•è®¿é—®ã€‚
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>åŸŸå</label>
                                <input type="text" id="resource-domain" placeholder="ä¾‹å¦‚: pan.baidu.com">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>æœç´¢URLæ¨¡æ¿ï¼ˆå¯é€‰ï¼‰</label>
                                <input type="text" id="resource-search-urls" placeholder="ä¾‹å¦‚: https://pan.baidu.com/s?wd={query}ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš”">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>å¤åˆ¶æœç´¢é“¾æ¥ï¼ˆè‡ªåŠ¨è§£æï¼‰</label>
                                <input type="text" id="resource-copy-url" placeholder="ç²˜è´´ä¸€ä¸ªæœç´¢é“¾æ¥ï¼Œä¾‹å¦‚: https://pan.baidu.com/s/1abc123">
                                <button class="btn btn-secondary" onclick="parseResourceUrl()">è§£æé“¾æ¥</button>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="addResourceSite()">æ·»åŠ ç½‘ç«™</button>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">èµ„æºç½‘ç«™åˆ—è¡¨</div>
                        </div>
                        <div id="resource-sites" class="site-list">
                            <div class="loading">åŠ è½½ä¸­...</div>
                        </div>
                    </div>
                </div>
        
                <!-- åˆ†ç±»ç®¡ç†é¡µé¢ -->
                <div id="categories" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">èµ„æºåˆ†ç±»ç®¡ç†</div>
                        </div>
                        <div class="card-description">ç®¡ç†èµ„æºç½‘ç«™çš„åˆ†ç±»ï¼Œå¯ä»¥åˆ›å»ºè‡ªå®šä¹‰åˆ†ç±»æ¥æ›´å¥½åœ°ç»„ç»‡ç½‘ç«™</div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>åˆ†ç±»åç§°</label>
                                <input type="text" id="category-name" placeholder="ä¾‹å¦‚: æ¸¸æˆã€å›¾ä¹¦ã€è§†é¢‘">
                            </div>
                            <div class="form-group">
                                <label>åˆ†ç±»æè¿°ï¼ˆå¯é€‰ï¼‰</label>
                                <input type="text" id="category-description" placeholder="ä¾‹å¦‚: æ¸¸æˆç›¸å…³èµ„æº">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>é€‰æ‹©ç½‘ç«™ï¼ˆå¯é€‰ï¼‰</label>
                            <div class="site-selection">
                                <div class="site-selection-header">
                                    <input type="checkbox" id="select-all-sites" onchange="toggleAllSites()">
                                    <label for="select-all-sites">å…¨é€‰</label>
                                    <span class="selected-count">å·²é€‰æ‹© 0 ä¸ªç½‘ç«™</span>
                                </div>
                                <div id="available-sites" class="site-checkbox-list">
                                    <div class="loading">åŠ è½½ä¸­...</div>
                                </div>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" onclick="addCategory()">æ·»åŠ åˆ†ç±»</button>
                        
                        <div style="margin-top: 1rem;">
                            <h4 style="color: var(--txt); margin-bottom: 0.5rem;">ç°æœ‰åˆ†ç±»</h4>
                            <div id="categories-list" class="site-list">
                                <div class="loading">åŠ è½½ä¸­...</div>
                            </div>
                        </div>
                    </div>
                </div>
        
                <!-- é»‘åå•é¡µé¢ -->
                <div id="blacklist" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">æ·»åŠ é»‘åå•</div>
                        </div>
                        <div class="card-description">
                            <strong>æ³¨æ„ï¼š</strong>é»‘åå•ä¸­çš„åŸŸåå°†è¢«å®Œå…¨è¿‡æ»¤ï¼Œä¸ä¼šå‡ºç°åœ¨ä»»ä½•æœç´¢ç»“æœä¸­ã€‚è¯·è°¨æ…æ·»åŠ ï¼Œé¿å…è¯¯è¿‡æ»¤æœ‰ç”¨ç½‘ç«™ã€‚
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>åŸŸå</label>
                                <input type="text" id="blacklist-domain" placeholder="ä¾‹å¦‚: spam.com">
                            </div>
                        </div>
                        <button class="btn btn-danger" onclick="addToBlacklistManual()">æ·»åŠ åˆ°é»‘åå•</button>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">é»‘åå•åˆ—è¡¨</div>
                        </div>
                        <div id="blacklist-sites" class="site-list">
                            <div class="loading">åŠ è½½ä¸­...</div>
                        </div>
                    </div>
                </div>
        
                <!-- è®¾ç½®é¡µé¢ -->
                <div id="settings" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">æœç´¢è®¾ç½®</div>
                        </div>
                        <div class="card-description">é…ç½®æœç´¢å‚æ•°å’Œç³»ç»Ÿè®¾ç½®</div>
                        
                        <div class="form-group">
                            <label>æœç´¢URLæ¨¡æ¿ç®¡ç†</label>
                            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                <select id="search-url-site-type" class="form-control" style="flex: 1;">
                                    <option value="resource_sites">èµ„æºç½‘ç«™</option>
                                    <option value="web_sites">ç½‘é¡µç½‘ç«™</option>
                                    <option value="video_sites">è§†é¢‘ç½‘ç«™</option>
                                    <option value="image_sites">å›¾ç‰‡ç½‘ç«™</option>
                                </select>
                                <button class="btn btn-primary" onclick="loadSearchUrls()">åŠ è½½é…ç½®</button>
                            </div>
                            <div id="search-urls-container" style="display: none;">
                                <div id="search-urls-list"></div>
                                <button class="btn btn-success" onclick="saveSearchUrls()" style="margin-top: 10px;">ä¿å­˜é…ç½®</button>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>æ¯ä¸ªæœç´¢å¼•æ“æœ€å¤§ç»“æœæ•°ï¼ˆä¼šå½±å“åŠ è½½é€Ÿåº¦ï¼‰</label>
                            <input type="number" id="engine-max-results" value="35" min="1" max="1000">
                            <small style="color: var(--muted);">è®¾ç½®æ¯ä¸ªæœç´¢å¼•æ“è¿”å›çš„æœ€å¤§ç»“æœæ•°ï¼Œæ•°å€¼è¶Šå¤§åŠ è½½è¶Šæ…¢ä½†ç»“æœè¶Šå…¨é¢</small>
                        </div>
                        
                        <div class="form-group">
                            <label>æ¯ä¸ªç½‘ç«™æœç´¢è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰</label>
                            <input type="number" id="site-timeout" value="8" min="1" max="60">
                            <small style="color: var(--muted);">è®¾ç½®æ¯ä¸ªç½‘ç«™æœç´¢çš„è¶…æ—¶æ—¶é—´ï¼Œæ—¶é—´è¶Šé•¿ç­‰å¾…è¶Šä¹…ä½†æˆåŠŸç‡è¶Šé«˜</small>
                        </div>
                        
                        <button class="btn btn-primary" onclick="saveSettings()">ä¿å­˜è®¾ç½®</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <script>
        let config = {};
        
        // è‡ªé€‚åº”åŠŸèƒ½
        var isMobile = false
        var isTablet = false
        var isDesktop = true
        
        // æ£€æµ‹è®¾å¤‡ç±»å‹
        function detectDevice() {
            const width = window.innerWidth
            if (width <= 360) {
                isMobile = true
                isTablet = false
                isDesktop = false
                document.documentElement.style.fontSize = '12px'
            } else if (width <= 768) {
                isMobile = false
                isTablet = true
                isDesktop = false
                document.documentElement.style.fontSize = '14px'
            } else {
                isMobile = false
                isTablet = false
                isDesktop = true
                document.documentElement.style.fontSize = '16px'
            }
            
            // æ›´æ–°UIå…ƒç´ 
            updateUIForDevice()
        }
        
        // æ ¹æ®è®¾å¤‡ç±»å‹æ›´æ–°UI
        function updateUIForDevice() {
            const container = document.querySelector('.container')
            const tabs = document.querySelector('.tabs')
            
            if (isMobile) {
                // ç§»åŠ¨ç«¯ä¼˜åŒ–
                if (container) container.classList.add('mobile')
                if (tabs) tabs.classList.add('mobile')
            } else if (isTablet) {
                // å¹³æ¿ä¼˜åŒ–
                if (container) container.classList.add('tablet')
                if (tabs) tabs.classList.add('tablet')
            } else {
                // æ¡Œé¢ç«¯
                if (container) container.classList.remove('mobile', 'tablet')
                if (tabs) tabs.classList.remove('mobile', 'tablet')
            }
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–è‡ªé€‚åº”åŠŸèƒ½
            detectDevice()
            
            // ç›‘å¬çª—å£å¤§å°å˜åŒ–
            window.addEventListener('resize', function(){
                detectDevice()
            })
            
            loadConfig();
            setupNavigation();
        });
        
        // è®¾ç½®å¯¼èˆª
        function setupNavigation() {
            const navItems = document.querySelectorAll('.nav-item');
            const contents = document.querySelectorAll('.tab-content');
            
            // é¡µé¢æ ‡é¢˜å’Œæè¿°æ˜ å°„
            const pageInfo = {
                'overview': { title: 'æ¦‚è§ˆ', description: 'æŸ¥çœ‹ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯å’Œå¿«é€Ÿæ“ä½œ' },
                'web': { title: 'ç½‘é¡µæœç´¢', description: 'ç®¡ç†ç½‘é¡µæœç´¢ç½‘ç«™é…ç½®' },
                'images': { title: 'å›¾ç‰‡æœç´¢', description: 'ç®¡ç†å›¾ç‰‡æœç´¢ç½‘ç«™é…ç½®' },
                'videos': { title: 'è§†é¢‘æœç´¢', description: 'ç®¡ç†è§†é¢‘æœç´¢ç½‘ç«™é…ç½®' },
                'resources': { title: 'èµ„æºæœç´¢', description: 'ç®¡ç†èµ„æºæœç´¢ç½‘ç«™é…ç½®' },
                'categories': { title: 'åˆ†ç±»ç®¡ç†', description: 'ç®¡ç†èµ„æºç½‘ç«™çš„åˆ†ç±»å’Œæ ‡ç­¾' },
                'blacklist': { title: 'é»‘åå•', description: 'ç®¡ç†è¢«å±è”½çš„ç½‘ç«™åŸŸå' },
                'settings': { title: 'è®¾ç½®', description: 'é…ç½®æœç´¢å‚æ•°å’Œç³»ç»Ÿè®¾ç½®' }
            };
            
            navItems.forEach(navItem => {
                navItem.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                    navItems.forEach(n => n.classList.remove('active'));
                    contents.forEach(c => c.classList.remove('active'));
                    
                    // æ·»åŠ æ´»åŠ¨çŠ¶æ€
                    this.classList.add('active');
                    document.getElementById(targetTab).classList.add('active');
                    
                    // æ›´æ–°é¡µé¢æ ‡é¢˜å’Œæè¿°
                    const info = pageInfo[targetTab];
                    if (info) {
                        document.getElementById('content-title').textContent = info.title;
                        document.getElementById('content-description').textContent = info.description;
                    }
                    
                    
                    // åŠ è½½å¯¹åº”æ•°æ®
                    if (targetTab !== 'overview') {
                        loadTabData(targetTab);
                    }
                });
            });
        }
        
        // é‡æ–°åŠ è½½å½“å‰æ ‡ç­¾é¡µçš„ç½‘ç«™åˆ—è¡¨
        function loadSites() {
            const currentTab = document.querySelector('.nav-item.active');
            if (currentTab) {
                const tabName = currentTab.getAttribute('data-tab');
                loadTabData(tabName);
            }
        }
        
        // åŠ è½½é…ç½®
        async function loadConfig() {
            try {
                const response = await fetch('/api/config');
                config = await response.json();
                updateOverview();
                loadSettings();
                
                // åˆ·æ–°æ‰€æœ‰ç½‘ç«™åˆ—è¡¨
                loadWebSites();
                loadImageSites();
                loadVideoSites();
                loadResourceSites();
                loadBlacklist();
                loadAvailableSites(); // åŠ è½½å¯ç”¨ç½‘ç«™åˆ—è¡¨
            } catch (error) {
                console.error('åŠ è½½é…ç½®å¤±è´¥:', error);
                showError('åŠ è½½é…ç½®å¤±è´¥');
            }
        }
        
        // åŠ è½½è®¾ç½®
        function loadSettings() {
            if (config.settings) {
                document.getElementById('engine-max-results').value = config.settings.engine_max_results || 35;
                document.getElementById('site-timeout').value = config.settings.site_timeout || 8;
            }
        }
        
        // æ›´æ–°æ¦‚è§ˆ
        function updateOverview() {
            const webCount = countSites('web_sites');
            const imageCount = countSites('image_sites');
            const videoCount = countSites('video_sites');
            const resourceCount = countSites('resource_sites');
            const blacklistCount = config.blacklist?.domains?.length || 0;
            
            document.getElementById('web-count').textContent = webCount;
            document.getElementById('image-count').textContent = imageCount;
            document.getElementById('video-count').textContent = videoCount;
            document.getElementById('resource-count').textContent = resourceCount;
            document.getElementById('blacklist-count').textContent = blacklistCount;
        }
        
        // è®¡ç®—ç½‘ç«™æ•°é‡
        function countSites(siteType) {
            if (!config[siteType]) return 0;
            let count = 0;
            for (const category in config[siteType]) {
                // åªè®¡ç®—ä¸»é…ç½®ï¼ˆcustomï¼‰çš„åŸŸåæ•°é‡ï¼Œä¸åŒ…æ‹¬åˆ†ç±»
                if (category === 'custom' && config[siteType][category].domains) {
                    count += config[siteType][category].domains.length;
                }
            }
            return count;
        }
        
        // åŠ è½½æ ‡ç­¾é¡µæ•°æ®
        function loadTabData(tabName) {
            switch(tabName) {
                case 'web':
                    loadWebSites();
                    break;
                case 'images':
                    loadImageSites();
                    break;
                case 'videos':
                    loadVideoSites();
                    break;
                case 'resources':
                    loadResourceSites();
                    break;
                case 'categories':
                    loadCategories();
                    loadAvailableSites();
                    break;
                case 'blacklist':
                    loadBlacklist();
                    break;
            }
        }
        
        // åŠ è½½ç½‘é¡µç½‘ç«™
        function loadWebSites() {
            const container = document.getElementById('web-sites');
            container.innerHTML = '';
            
            if (!config.web_sites) {
                container.innerHTML = '<div class="loading">æš‚æ— ç½‘é¡µç½‘ç«™</div>';
                return;
            }
            
            for (const [category, data] of Object.entries(config.web_sites)) {
                if (data.domains) {
                    data.domains.forEach(domain => {
                        // æ£€æŸ¥åŸŸåæ˜¯å¦æœ‰ç‹¬ç«‹çŠ¶æ€ï¼Œå¦åˆ™ä½¿ç”¨åˆ†ç±»é»˜è®¤çŠ¶æ€
                        const domainStatus = data.domain_status && data.domain_status[domain] !== undefined 
                            ? data.domain_status[domain] 
                            : data.enabled;
                        console.log(`åŸŸå ${domain} çŠ¶æ€:`, domainStatus, 'domain_status:', data.domain_status);
                        const item = createSiteItem(domain, category, domainStatus, 'web');
                        container.appendChild(item);
                    });
                }
            }
        }
        
        // åŠ è½½å›¾ç‰‡ç½‘ç«™
        function loadImageSites() {
            const container = document.getElementById('image-sites');
            container.innerHTML = '';
            
            if (!config.image_sites) {
                container.innerHTML = '<div class="loading">æš‚æ— å›¾ç‰‡ç½‘ç«™</div>';
                return;
            }
            
            for (const [category, data] of Object.entries(config.image_sites)) {
                if (data.domains) {
                    data.domains.forEach(domain => {
                        // æ£€æŸ¥åŸŸåæ˜¯å¦æœ‰ç‹¬ç«‹çŠ¶æ€ï¼Œå¦åˆ™ä½¿ç”¨åˆ†ç±»é»˜è®¤çŠ¶æ€
                        const domainStatus = data.domain_status && data.domain_status[domain] !== undefined 
                            ? data.domain_status[domain] 
                            : data.enabled;
                        const item = createSiteItem(domain, category, domainStatus, 'images');
                        container.appendChild(item);
                    });
                }
            }
        }
        
        // åŠ è½½è§†é¢‘ç½‘ç«™
        function loadVideoSites() {
            const container = document.getElementById('video-sites');
            container.innerHTML = '';
            
            if (!config.video_sites) {
                container.innerHTML = '<div class="loading">æš‚æ— è§†é¢‘ç½‘ç«™</div>';
                return;
            }
            
            for (const [category, data] of Object.entries(config.video_sites)) {
                if (data.domains) {
                    data.domains.forEach(domain => {
                        // æ£€æŸ¥åŸŸåæ˜¯å¦æœ‰ç‹¬ç«‹çŠ¶æ€ï¼Œå¦åˆ™ä½¿ç”¨åˆ†ç±»é»˜è®¤çŠ¶æ€
                        const domainStatus = data.domain_status && data.domain_status[domain] !== undefined 
                            ? data.domain_status[domain] 
                            : data.enabled;
                        const item = createSiteItem(domain, category, domainStatus, 'videos');
                        container.appendChild(item);
                    });
                }
            }
        }
        
        // åŠ è½½èµ„æºç½‘ç«™
        function loadResourceSites() {
            const container = document.getElementById('resource-sites');
            container.innerHTML = '';
            
            if (!config.resource_sites || !config.resource_sites.custom) {
                container.innerHTML = '<div class="loading">æš‚æ— èµ„æºç½‘ç«™</div>';
                return;
            }
            
            // åªä»customåˆ†ç±»ï¼ˆä¸»åˆ†ç±»ï¼‰åŠ è½½èµ„æºç½‘ç«™
            const customData = config.resource_sites.custom;
            if (customData.domains) {
                customData.domains.forEach(domain => {
                    // æ£€æŸ¥åŸŸåæ˜¯å¦æœ‰ç‹¬ç«‹çŠ¶æ€ï¼Œå¦åˆ™ä½¿ç”¨åˆ†ç±»é»˜è®¤çŠ¶æ€
                    const domainStatus = customData.domain_status && customData.domain_status[domain] !== undefined 
                        ? customData.domain_status[domain] 
                        : customData.enabled;
                    const item = createResourceSiteItem(domain, 'custom', domainStatus, 'resources');
                    container.appendChild(item);
                });
            }
        }
        
        // åˆ›å»ºèµ„æºç½‘ç«™é¡¹ç›®ï¼ˆå¸¦åˆ†ç±»æ˜¾ç¤ºï¼‰
        function createResourceSiteItem(domain, category, enabled, siteType) {
            const item = document.createElement('div');
            item.className = 'site-item';
            item.innerHTML = `
                <div class="site-info">
                    <div class="site-domain">${domain}</div>
                    <div class="site-options">
                        <label class="checkbox-label">
                            <input type="checkbox" id="www-prefix-${domain.replace(/\./g, '-')}" onchange="toggleWwwPrefix('${domain}', '${siteType}')">
                            <span>è®¿é—®æ—¶æ·»åŠ wwwå‰ç¼€</span>
                        </label>
                    </div>
                </div>
                <div class="site-actions">
                    <button class="btn btn-info" onclick="visitSite('${domain}')">è®¿é—®</button>
                    <button class="btn btn-primary" onclick="editSite('${domain}', '${siteType}')">ä¿®æ”¹</button>
                    <button class="btn btn-warning" onclick="addToBlacklist('${domain}')">æ·»åŠ è‡³é»‘åå•</button>
                    <button class="btn ${enabled ? 'btn-warning' : 'btn-success'}" onclick="toggleSite('${domain}', '${siteType}', ${!enabled})">
                        ${enabled ? 'ç¦ç”¨' : 'å¯ç”¨'}
                    </button>
                    <button class="btn btn-danger" onclick="removeSite('${domain}', '${siteType}')">åˆ é™¤</button>
                </div>
            `;
            return item;
        }
        
        // åŠ è½½é»‘åå•
        function loadBlacklist() {
            const container = document.getElementById('blacklist-sites');
            container.innerHTML = '';
            
            if (!config.blacklist?.domains?.length) {
                container.innerHTML = '<div class="loading">æš‚æ— é»‘åå•</div>';
                return;
            }
            
            config.blacklist.domains.forEach(domain => {
                const item = document.createElement('div');
                item.className = 'blacklist-item';
                item.innerHTML = `
                    <div class="site-info">
                        <div class="site-domain">${domain}</div>
                    </div>
                    <div class="site-actions">
                        <button class="btn btn-danger" onclick="removeFromBlacklist('${domain}')">ç§»é™¤</button>
                    </div>
                `;
                container.appendChild(item);
            });
        }
        
        // åˆ›å»ºç½‘ç«™é¡¹ç›®
        function createSiteItem(domain, category, enabled, siteType) {
            const item = document.createElement('div');
            item.className = 'site-item';
            item.innerHTML = `
                <div class="site-info">
                    <div class="site-domain">${domain}</div>
                    <div class="site-options">
                        <label class="checkbox-label">
                            <input type="checkbox" id="www-prefix-${domain.replace(/\./g, '-')}" onchange="toggleWwwPrefix('${domain}', '${siteType}')">
                            <span>è®¿é—®æ—¶æ·»åŠ wwwå‰ç¼€</span>
                        </label>
                    </div>
                </div>
                <div class="site-actions">
                    <button class="btn btn-info" onclick="visitSite('${domain}')">è®¿é—®</button>
                    <button class="btn btn-primary" onclick="editSite('${domain}', '${siteType}')">ä¿®æ”¹</button>
                    <button class="btn btn-warning" onclick="addToBlacklist('${domain}')">æ·»åŠ è‡³é»‘åå•</button>
                    <button class="btn ${enabled ? 'btn-warning' : 'btn-success'}" onclick="toggleSite('${domain}', '${siteType}', ${!enabled})">
                        ${enabled ? 'ç¦ç”¨' : 'å¯ç”¨'}
                    </button>
                    <button class="btn btn-danger" onclick="removeSite('${domain}', '${siteType}')">åˆ é™¤</button>
                </div>
            `;
            return item;
        }
        
        // æ·»åŠ ç½‘é¡µç½‘ç«™
        async function addWebSite() {
            const domain = document.getElementById('web-domain').value.trim();
            const category = 'custom';
            const searchUrls = document.getElementById('web-search-urls').value.trim();
            
            if (!domain) {
                showError('è¯·è¾“å…¥åŸŸå');
                return;
            }
            
            const searchUrlList = searchUrls ? searchUrls.split(',').map(url => url.trim()).filter(url => url) : [];
            
            try {
                const response = await fetch('/api/config/add-site', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        domain, siteType: 'web', searchUrls: searchUrlList
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    if (result.success) {
                        if (result.action === 'added') {
                            showSuccess(result.message);
                        } else if (result.action === 'updated') {
                            showSuccess(result.message);
                        }
                        await loadConfig();
                        loadWebSites();
                        clearForm('web');
                        document.getElementById('web-search-urls').value = '';
                    } else {
                        showError(result.message);
                    }
                } else {
                    showError('æ·»åŠ å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                showError('æ·»åŠ å¤±è´¥');
            }
        }
        
        // æ·»åŠ å›¾ç‰‡ç½‘ç«™
        async function addImageSite() {
            const domain = document.getElementById('image-domain').value.trim();
            const category = 'custom';
            const searchUrls = document.getElementById('image-search-urls').value.trim();
            
            if (!domain) {
                showError('è¯·è¾“å…¥åŸŸå');
                return;
            }
            
            const searchUrlList = searchUrls ? searchUrls.split(',').map(url => url.trim()).filter(url => url) : [];
            
            try {
                const response = await fetch('/api/config/add-site', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        domain, siteType: 'images', searchUrls: searchUrlList
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    if (result.success) {
                        if (result.action === 'added') {
                            showSuccess(result.message);
                        } else if (result.action === 'updated') {
                            showSuccess(result.message);
                        }
                        await loadConfig();
                        loadImageSites();
                        clearForm('image');
                        document.getElementById('image-search-urls').value = '';
                    } else {
                        showError(result.message);
                    }
                } else {
                    showError('æ·»åŠ å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                showError('æ·»åŠ å¤±è´¥');
            }
        }
        
        // æ·»åŠ è§†é¢‘ç½‘ç«™
        async function addVideoSite() {
            const domain = document.getElementById('video-domain').value.trim();
            const category = 'custom';
            const searchUrls = document.getElementById('video-search-urls').value.trim();
            
            if (!domain) {
                showError('è¯·è¾“å…¥åŸŸå');
                return;
            }
            
            const searchUrlList = searchUrls ? searchUrls.split(',').map(url => url.trim()).filter(url => url) : [];
            
            try {
                const response = await fetch('/api/config/add-site', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        domain, siteType: 'videos', searchUrls: searchUrlList
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    if (result.success) {
                        if (result.action === 'added') {
                            showSuccess(result.message);
                        } else if (result.action === 'updated') {
                            showSuccess(result.message);
                        }
                        await loadConfig();
                        loadVideoSites();
                        clearForm('video');
                        document.getElementById('video-search-urls').value = '';
                    } else {
                        showError(result.message);
                    }
                } else {
                    showError('æ·»åŠ å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                showError('æ·»åŠ å¤±è´¥');
            }
        }
        
        // æ·»åŠ èµ„æºç½‘ç«™
        async function addResourceSite() {
            const domain = document.getElementById('resource-domain').value.trim();
            const searchUrls = document.getElementById('resource-search-urls').value.trim();
            
            if (!domain) {
                showError('è¯·è¾“å…¥åŸŸå');
                return;
            }
            
            const searchUrlList = searchUrls ? searchUrls.split(',').map(url => url.trim()) : [];
            
            try {
                const response = await fetch('/api/config/add-site', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        domain, siteType: 'resources', category: 'custom', searchUrls: searchUrlList
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    if (result.success) {
                        if (result.action === 'added') {
                            showSuccess(result.message);
                        } else if (result.action === 'updated') {
                            showSuccess(result.message);
                        }
                        await loadConfig();
                        loadResourceSites();
                        loadCategories();
                        clearForm('resource');
                    } else {
                        showError(result.message);
                    }
                } else {
                    showError('æ·»åŠ å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                showError('æ·»åŠ å¤±è´¥');
            }
        }
        
        // è·å–é€‰ä¸­çš„ç½‘ç«™
        function getSelectedSites() {
            const checkboxes = document.querySelectorAll('#available-sites input[type="checkbox"]:checked');
            return Array.from(checkboxes).map(cb => ({
                domain: cb.value,
                name: cb.nextElementSibling.textContent
            }));
        }
        
        // å…¨é€‰/å–æ¶ˆå…¨é€‰ç½‘ç«™
        function toggleAllSites() {
            const selectAll = document.getElementById('select-all-sites');
            const checkboxes = document.querySelectorAll('#available-sites input[type="checkbox"]');
            
            checkboxes.forEach(cb => {
                cb.checked = selectAll.checked;
            });
            
            updateSelectedCount();
        }
        
        // æ›´æ–°é€‰ä¸­æ•°é‡æ˜¾ç¤º
        function updateSelectedCount() {
            const selectedCount = document.querySelectorAll('#available-sites input[type="checkbox"]:checked').length;
            const totalCount = document.querySelectorAll('#available-sites input[type="checkbox"]').length;
            document.querySelector('.selected-count').textContent = `å·²é€‰æ‹© ${selectedCount} ä¸ªç½‘ç«™`;
            
            // æ›´æ–°å…¨é€‰çŠ¶æ€
            const selectAll = document.getElementById('select-all-sites');
            if (selectedCount === 0) {
                selectAll.checked = false;
                selectAll.indeterminate = false;
            } else if (selectedCount === totalCount) {
                selectAll.checked = true;
                selectAll.indeterminate = false;
            } else {
                selectAll.checked = false;
                selectAll.indeterminate = true;
            }
        }
        
        // åŠ è½½å¯ç”¨ç½‘ç«™åˆ—è¡¨
        async function loadAvailableSites() {
            try {
                const response = await fetch('/api/config');
                const config = await response.json();
                
                const resourceSites = config.resource_sites || {};
                const sitesMap = new Map();
                
                // æ”¶é›†æ‰€æœ‰èµ„æºç½‘ç«™åŠå…¶åˆ†ç±»ä¿¡æ¯
                for (const [category, categoryConfig] of Object.entries(resourceSites)) {
                    if (categoryConfig.domains) {
                        for (const domain of categoryConfig.domains) {
                            if (!sitesMap.has(domain)) {
                                sitesMap.set(domain, {
                                    domain: domain,
                                    name: domain,
                                    categories: []
                                });
                            }
                            sitesMap.get(domain).categories.push(category);
                        }
                    }
                }
                
                // æ¸²æŸ“ç½‘ç«™é€‰æ‹©åˆ—è¡¨
                const container = document.getElementById('available-sites');
                const sites = Array.from(sitesMap.values());
                
                if (sites.length === 0) {
                    container.innerHTML = '<div class="loading">æš‚æ— å¯ç”¨ç½‘ç«™</div>';
                    return;
                }
                
                container.innerHTML = sites.map(site => `
                    <div class="site-checkbox-item">
                        <input type="checkbox" value="${site.domain}" onchange="updateSelectedCount()">
                        <label>
                            <span class="site-name">${site.name}</span>
                            <span class="site-categories">å·²åˆ†ç±»: ${site.categories.join(', ')}</span>
                        </label>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('åŠ è½½ç½‘ç«™åˆ—è¡¨å¤±è´¥:', error);
                document.getElementById('available-sites').innerHTML = '<div class="loading">åŠ è½½å¤±è´¥</div>';
            }
        }
        
        // æ·»åŠ åˆ†ç±»
        async function addCategory() {
            const name = document.getElementById('category-name').value.trim();
            const description = document.getElementById('category-description').value.trim();
            
            if (!name) {
                showError('è¯·è¾“å…¥åˆ†ç±»åç§°');
                return;
            }
            
            // è·å–é€‰ä¸­çš„ç½‘ç«™
            const selectedSites = getSelectedSites();
            
            try {
                const response = await fetch('/api/config/categories', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        name, description, action: 'add', sites: selectedSites
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    if (result.success) {
                        showSuccess('åˆ†ç±»æ·»åŠ æˆåŠŸ');
                        await loadConfig();
                        loadCategories();
                        loadAvailableSites(); // é‡æ–°åŠ è½½ç½‘ç«™åˆ—è¡¨
                        document.getElementById('category-name').value = '';
                        document.getElementById('category-description').value = '';
                        // æ¸…ç©ºé€‰æ‹©
                        document.querySelectorAll('#available-sites input[type="checkbox"]').forEach(cb => cb.checked = false);
                        updateSelectedCount();
                    } else {
                        showError(result.message);
                    }
                } else {
                    showError('æ·»åŠ å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                showError('æ·»åŠ å¤±è´¥');
            }
        }
        
        // åˆ‡æ¢åˆ†ç±»å±•å¼€/æ”¶èµ·
        function toggleCategory(name) {
            const sitesDiv = document.getElementById(`sites-${name}`);
            const expandIcon = document.getElementById(`expand-${name}`);
            
            if (sitesDiv.style.display === 'none') {
                sitesDiv.style.display = 'block';
                expandIcon.textContent = 'â–²';
                expandIcon.style.transform = 'rotate(180deg)';
            } else {
                sitesDiv.style.display = 'none';
                expandIcon.textContent = 'â–¼';
                expandIcon.style.transform = 'rotate(0deg)';
            }
        }
        
        // ä»åˆ†ç±»ä¸­ç§»é™¤ç½‘ç«™
        async function removeSiteFromCategory(domain, categoryName) {
            if (!confirm(`ç¡®å®šè¦ä»åˆ†ç±» "${categoryName}" ä¸­ç§»é™¤ç½‘ç«™ "${domain}" å—ï¼Ÿ`)) return;
            
            try {
                const response = await fetch('/api/config/remove-site-from-category', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        domain: domain,
                        siteType: 'resources',
                        category: categoryName
                    })
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                    showSuccess('ç½‘ç«™å·²ä»åˆ†ç±»ä¸­ç§»é™¤');
                    await loadConfig();
                    loadCategories();
                    loadAvailableSites();
                } else {
                    showError(result.message || 'ç§»é™¤å¤±è´¥');
                }
            } catch (error) {
                showError('ç§»é™¤å¤±è´¥');
            }
        }
        
        // æ˜¾ç¤ºæ·»åŠ ç½‘ç«™åˆ°åˆ†ç±»çš„æ¨¡æ€æ¡†
        function showAddSitesModal(categoryName) {
            // åˆ›å»ºæ¨¡æ€æ¡†
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>æ·»åŠ ç½‘ç«™åˆ°åˆ†ç±» "${categoryName}"</h3>
                        <button class="close-btn" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="site-selection">
                            <div class="site-selection-header">
                                <input type="checkbox" id="modal-select-all-sites" onchange="toggleModalAllSites()">
                                <label for="modal-select-all-sites">å…¨é€‰</label>
                            </div>
                            <div id="modal-available-sites" class="site-checkbox-list">
                                <div class="loading">åŠ è½½ä¸­...</div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
                        <button class="btn btn-primary" onclick="addSitesToCategory('${categoryName}')">æ·»åŠ </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // åŠ è½½å¯ç”¨çš„ç½‘ç«™ï¼ˆæ’é™¤å·²åœ¨åˆ†ç±»ä¸­çš„ç½‘ç«™ï¼‰
            loadModalAvailableSites(categoryName);
        }
        
        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            const modal = document.querySelector('.modal');
            if (modal) {
                modal.remove();
            }
        }
        
        // åŠ è½½æ¨¡æ€æ¡†ä¸­çš„å¯ç”¨ç½‘ç«™åˆ—è¡¨
        async function loadModalAvailableSites(categoryName) {
            try {
                const response = await fetch('/api/config');
                const config = await response.json();
                
                const resourceSites = config.resource_sites || {};
                const currentCategorySites = resourceSites[categoryName]?.domains || [];
                const sitesMap = new Map();
                
                // æ”¶é›†æ‰€æœ‰èµ„æºç½‘ç«™åŠå…¶åˆ†ç±»ä¿¡æ¯
                for (const [category, categoryConfig] of Object.entries(resourceSites)) {
                    if (categoryConfig.domains) {
                        for (const domain of categoryConfig.domains) {
                            if (!sitesMap.has(domain)) {
                                sitesMap.set(domain, {
                                    domain: domain,
                                    name: domain,
                                    categories: []
                                });
                            }
                            sitesMap.get(domain).categories.push(category);
                        }
                    }
                }
                
                // è¿‡æ»¤æ‰å·²åœ¨å½“å‰åˆ†ç±»ä¸­çš„ç½‘ç«™
                const availableSites = Array.from(sitesMap.values()).filter(site => 
                    !currentCategorySites.includes(site.domain)
                );
                
                // æ¸²æŸ“ç½‘ç«™é€‰æ‹©åˆ—è¡¨
                const container = document.getElementById('modal-available-sites');
                if (availableSites.length === 0) {
                    container.innerHTML = '<div class="loading">æš‚æ— å¯ç”¨ç½‘ç«™</div>';
                    return;
                }
                
                container.innerHTML = availableSites.map(site => `
                    <div class="site-checkbox-item">
                        <input type="checkbox" value="${site.domain}" onchange="updateModalSelectedCount()">
                        <label>
                            <span class="site-name">${site.name}</span>
                            <span class="site-categories">å·²åˆ†ç±»: ${site.categories.join(', ')}</span>
                        </label>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('åŠ è½½ç½‘ç«™åˆ—è¡¨å¤±è´¥:', error);
                document.getElementById('modal-available-sites').innerHTML = '<div class="loading">åŠ è½½å¤±è´¥</div>';
            }
        }
        
        // å…¨é€‰/å–æ¶ˆå…¨é€‰æ¨¡æ€æ¡†ä¸­çš„ç½‘ç«™
        function toggleModalAllSites() {
            const selectAll = document.getElementById('modal-select-all-sites');
            const checkboxes = document.querySelectorAll('#modal-available-sites input[type="checkbox"]');
            
            checkboxes.forEach(cb => {
                cb.checked = selectAll.checked;
            });
            
            updateModalSelectedCount();
        }
        
        // æ›´æ–°æ¨¡æ€æ¡†ä¸­å…¨é€‰çŠ¶æ€
        function updateModalSelectedCount() {
            const selectedCount = document.querySelectorAll('#modal-available-sites input[type="checkbox"]:checked').length;
            const totalCount = document.querySelectorAll('#modal-available-sites input[type="checkbox"]').length;
            
            // æ›´æ–°å…¨é€‰çŠ¶æ€
            const selectAll = document.getElementById('modal-select-all-sites');
            if (selectAll) {
                if (selectedCount === 0) {
                    selectAll.checked = false;
                    selectAll.indeterminate = false;
                } else if (selectedCount === totalCount) {
                    selectAll.checked = true;
                    selectAll.indeterminate = false;
                } else {
                    selectAll.checked = false;
                    selectAll.indeterminate = true;
                }
            }
        }
        
        // æ·»åŠ ç½‘ç«™åˆ°åˆ†ç±»
        async function addSitesToCategory(categoryName) {
            const selectedSites = getModalSelectedSites();
            
            if (selectedSites.length === 0) {
                showError('è¯·é€‰æ‹©è¦æ·»åŠ çš„ç½‘ç«™');
                return;
            }
            
            try {
                let successCount = 0;
                for (const site of selectedSites) {
                    const response = await fetch('/api/config/add-site-to-category', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            domain: site.domain,
                            siteType: 'resources',
                            category: categoryName
                        })
                    });
                    
                    const result = await response.json();
                    if (response.ok && result.success) {
                        successCount++;
                    }
                }
                
                if (successCount > 0) {
                    showSuccess(`æˆåŠŸæ·»åŠ  ${successCount} ä¸ªç½‘ç«™åˆ°åˆ†ç±»`);
                    closeModal();
                    await loadConfig();
                    loadCategories();
                    loadAvailableSites();
                } else {
                    showError('æ·»åŠ å¤±è´¥');
                }
            } catch (error) {
                showError('æ·»åŠ å¤±è´¥');
            }
        }
        
        // è·å–æ¨¡æ€æ¡†ä¸­é€‰ä¸­çš„ç½‘ç«™
        function getModalSelectedSites() {
            const checkboxes = document.querySelectorAll('#modal-available-sites input[type="checkbox"]:checked');
            return Array.from(checkboxes).map(cb => ({
                domain: cb.value,
                name: cb.nextElementSibling.textContent
            }));
        }
        
        // åˆ é™¤åˆ†ç±»
        async function deleteCategory(categoryName) {
            if (!confirm(`ç¡®å®šè¦åˆ é™¤åˆ†ç±» "${categoryName}" å—ï¼Ÿè¿™å°†å½±å“è¯¥åˆ†ç±»ä¸‹çš„æ‰€æœ‰ç½‘ç«™ã€‚`)) return;
            
            try {
                const response = await fetch('/api/config/categories', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        name: categoryName, action: 'delete'
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    if (result.success) {
                        showSuccess('åˆ†ç±»åˆ é™¤æˆåŠŸ');
                        await loadConfig();
                        loadCategories();
                        loadResourceSites();
                    } else {
                        showError(result.message);
                    }
                } else {
                    showError('åˆ é™¤å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                showError('åˆ é™¤å¤±è´¥');
            }
        }
        
        // åŠ è½½åˆ†ç±»åˆ—è¡¨
        function loadCategories() {
            const container = document.getElementById('categories-list');
            
            if (!config.resource_categories) {
                container.innerHTML = '<div class="loading">æš‚æ— åˆ†ç±»</div>';
                return;
            }
            
            // æ›´æ–°åˆ†ç±»åˆ—è¡¨æ˜¾ç¤º
            container.innerHTML = '';
            for (const [name, data] of Object.entries(config.resource_categories)) {
                // è®¡ç®—è¯¥åˆ†ç±»ä¸­çš„ç½‘ç«™æ•°é‡
                const categorySites = config.resource_sites?.[name]?.domains || [];
                const siteCount = categorySites.length;
                
                const item = document.createElement('div');
                item.className = 'category-item';
                item.innerHTML = `
                    <div class="category-header" onclick="toggleCategory('${name}')">
                        <div class="category-info">
                            <div class="category-name">${name}</div>
                            <div class="category-description">${data.description || 'æ— æè¿°'}</div>
                            <div class="category-count">åŒ…å« ${siteCount} ä¸ªç½‘ç«™</div>
                        </div>
                        <div class="category-actions">
                            <button class="btn btn-primary" onclick="showAddSitesModal('${name}')">æ·»åŠ ç½‘ç«™</button>
                            <button class="btn btn-danger" onclick="deleteCategory('${name}')">åˆ é™¤</button>
                            <span class="expand-icon" id="expand-${name}">â–¼</span>
                        </div>
                    </div>
                    <div class="category-sites" id="sites-${name}" style="display: none;">
                        <div class="sites-list">
                            ${categorySites.map(domain => `
                                <div class="site-in-category">
                                    <span class="site-domain">${domain}</span>
                                    <button class="btn btn-sm btn-danger" onclick="removeSiteFromCategory('${domain}', '${name}')">ç§»é™¤</button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                container.appendChild(item);
            }
        }
        
        // æ·»åŠ åˆ°é»‘åå•
        async function addToBlacklistManual() {
            const domain = document.getElementById('blacklist-domain').value.trim();
            
            if (!domain) {
                showError('è¯·è¾“å…¥åŸŸå');
                return;
            }
            
            try {
                const response = await fetch('/api/config/blacklist', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({domain, action: 'add'})
                });
                
                if (response.ok) {
                    showSuccess('æ·»åŠ æˆåŠŸ');
                    await loadConfig();
                    loadBlacklist();
                    document.getElementById('blacklist-domain').value = '';
                } else {
                    showError('æ·»åŠ å¤±è´¥');
                }
            } catch (error) {
                showError('æ·»åŠ å¤±è´¥');
            }
        }
        
        // åˆ‡æ¢ç½‘ç«™çŠ¶æ€
        async function toggleSite(domain, siteType, enabled) {
            try {
                console.log('åˆ‡æ¢ç½‘ç«™çŠ¶æ€:', {domain, siteType, enabled});
                const response = await fetch('/api/config/toggle-site', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({domain, siteType, enabled})
                });
                
                if (response.ok) {
                    showSuccess('çŠ¶æ€æ›´æ–°æˆåŠŸ');
                    // é‡æ–°åŠ è½½é…ç½®å¹¶æ›´æ–°ç•Œé¢
                    await loadConfig();
                    console.log('é‡æ–°åŠ è½½åçš„config:', config);
                    console.log('web_sites domain_status:', config.web_sites?.custom?.domain_status);
                    const currentTab = document.querySelector('.nav-item.active');
                    if (currentTab) {
                        const tabName = currentTab.getAttribute('data-tab');
                        console.log('é‡æ–°åŠ è½½æ ‡ç­¾:', tabName);
                        loadTabData(tabName);
                    }
                } else {
                    const errorData = await response.json();
                    console.error('æ›´æ–°å¤±è´¥:', errorData);
                    showError('æ›´æ–°å¤±è´¥: ' + (errorData.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                showError('æ›´æ–°å¤±è´¥');
            }
        }
        
        // åˆ é™¤ç½‘ç«™
        async function removeSite(domain, siteType) {
            if (!confirm(`ç¡®å®šè¦åˆ é™¤ ${domain} å—ï¼Ÿ`)) return;
            
            try {
                const response = await fetch('/api/config/remove-site', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({domain, siteType})
                });
                
                if (response.ok) {
                    showSuccess('åˆ é™¤æˆåŠŸ');
                    // é‡æ–°åŠ è½½é…ç½®å¹¶æ›´æ–°ç•Œé¢
                    await loadConfig();
                    const currentTab = document.querySelector('.nav-item.active');
                    if (currentTab) {
                        const tabName = currentTab.getAttribute('data-tab');
                        loadTabData(tabName);
                    }
                } else {
                    showError('åˆ é™¤å¤±è´¥');
                }
            } catch (error) {
                showError('åˆ é™¤å¤±è´¥');
            }
        }
        
        // ä»é»‘åå•ç§»é™¤
        async function removeFromBlacklist(domain) {
            if (!confirm(`ç¡®å®šè¦ä»é»‘åå•ç§»é™¤ ${domain} å—ï¼Ÿ`)) return;
            
            try {
                const response = await fetch('/api/config/blacklist', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({domain, action: 'remove'})
                });
                
                if (response.ok) {
                    showSuccess('ç§»é™¤æˆåŠŸ');
                    await loadConfig();
                    loadBlacklist();
                } else {
                    showError('ç§»é™¤å¤±è´¥');
                }
            } catch (error) {
                showError('ç§»é™¤å¤±è´¥');
            }
        }
        
        // ä¿å­˜è®¾ç½®
        async function saveSettings() {
            const engineMaxResults = parseInt(document.getElementById('engine-max-results').value);
            const siteTimeout = parseInt(document.getElementById('site-timeout').value);
            
            try {
                const response = await fetch('/api/config/settings', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        engineMaxResults,
                        siteTimeout
                    })
                });
                
                if (response.ok) {
                    showSuccess('è®¾ç½®ä¿å­˜æˆåŠŸ');
                    loadConfig();
                } else {
                    showError('ä¿å­˜å¤±è´¥');
                }
            } catch (error) {
                showError('ä¿å­˜å¤±è´¥');
            }
        }
        
        // åˆ·æ–°æ•°æ®
        async function refreshData() {
            await loadConfig();
            showSuccess('æ•°æ®å·²åˆ·æ–°');
        }
        
        // å¯¼å‡ºé…ç½®
        function exportConfig() {
            const dataStr = JSON.stringify(config, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'sites_config.json';
            link.click();
            URL.revokeObjectURL(url);
        }
        
        // å¯¼å…¥é…ç½®
        function importConfig() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const importedConfig = JSON.parse(e.target.result);
                            // è¿™é‡Œå¯ä»¥æ·»åŠ å…¥å£é…ç½®çš„é€»è¾‘
                            showSuccess('é…ç½®å¯¼å…¥æˆåŠŸ');
                        } catch (error) {
                            showError('é…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
        
        // é‡ç½®é…ç½®
        function resetConfig() {
            if (!confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰é…ç½®å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰è‡ªå®šä¹‰è®¾ç½®ã€‚')) return;
            
            fetch('/api/config/reset', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showSuccess(data.message || 'é…ç½®å·²é‡ç½®');
                    // é‡æ–°åŠ è½½é…ç½®æ•°æ®
                    setTimeout(async () => {
                        await loadConfig();
                        showSuccess('é…ç½®å·²é‡ç½®å¹¶åˆ·æ–°å®Œæˆ');
                    }, 500);
                } else {
                    showError(data.error || 'é‡ç½®é…ç½®å¤±è´¥');
                }
            })
            .catch(error => {
                console.error('é‡ç½®é…ç½®å¤±è´¥:', error);
                showError('é‡ç½®é…ç½®å¤±è´¥: ' + error.message);
            });
        }


        
        // æ¸…ç©ºè¡¨å•
        function clearForm(type) {
            const prefix = type === 'web' ? 'web' : type === 'image' ? 'image' : type === 'video' ? 'video' : 'resource';
            document.getElementById(`${prefix}-domain`).value = '';
            if (type === 'resource') {
                document.getElementById('resource-search-urls').value = '';
            }
        }
        
        // æ˜¾ç¤ºToastæç¤º
        function showToast(message, type = 'info') {
            // ç§»é™¤ç°æœ‰çš„toast
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // æ˜¾ç¤ºåŠ¨ç”»
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            // è‡ªåŠ¨éšè—
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.remove();
                    }
                }, 300);
            }, 3000);
        }

        // æœç´¢URLç®¡ç†åŠŸèƒ½
        let currentSearchUrls = {};

        async function loadSearchUrls() {
            const siteType = document.getElementById('search-url-site-type').value;
            const container = document.getElementById('search-urls-container');
            const list = document.getElementById('search-urls-list');
            
            try {
                const response = await fetch(`/api/config/search-urls/${siteType}`);
                const data = await response.json();
                
                if (response.ok) {
                    currentSearchUrls = data;
                    displaySearchUrls(data);
                    container.style.display = 'block';
                } else {
                    showToast('åŠ è½½é…ç½®å¤±è´¥: ' + data.error, 'error');
                }
            } catch (error) {
                showToast('åŠ è½½é…ç½®å¤±è´¥: ' + error.message, 'error');
            }
        }

        function displaySearchUrls(searchUrls) {
            const list = document.getElementById('search-urls-list');
            list.innerHTML = '';
            
            if (Object.keys(searchUrls).length === 0) {
                list.innerHTML = '<p style="color: #888;">æš‚æ— æœç´¢URLé…ç½®</p>';
                return;
            }
            
            for (const [domain, urls] of Object.entries(searchUrls)) {
                const domainDiv = document.createElement('div');
                domainDiv.style.marginBottom = '15px';
                domainDiv.style.padding = '10px';
                domainDiv.style.border = '1px solid #2a3442';
                domainDiv.style.borderRadius = '5px';
                domainDiv.style.backgroundColor = 'var(--card)';
                
                domainDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <strong style="color: var(--txt);">${domain}</strong>
                        <button class="btn btn-danger" onclick="removeDomain('${domain}')" style="padding: 2px 8px; font-size: 12px;">åˆ é™¤</button>
                    </div>
                    <div id="urls-${domain.replace(/\./g, '-')}">
                        ${urls.map((url, index) => `
                            <div style="display: flex; gap: 5px; margin-bottom: 5px;">
                                <input type="text" value="${url}" onchange="updateUrl('${domain}', ${index}, this.value)" style="flex: 1; padding: 5px; background: var(--bg); color: var(--txt); border: 1px solid #2a3442; border-radius: 3px;">
                                <button class="btn btn-danger" onclick="removeUrl('${domain}', ${index})" style="padding: 2px 6px; font-size: 12px;">åˆ é™¤</button>
                            </div>
                        `).join('')}
                        <button class="btn btn-primary" onclick="addUrl('${domain}')" style="padding: 2px 8px; font-size: 12px;">æ·»åŠ URL</button>
                    </div>
                `;
                
                list.appendChild(domainDiv);
            }
        }

        function updateUrl(domain, index, newUrl) {
            if (currentSearchUrls[domain]) {
                currentSearchUrls[domain][index] = newUrl;
            }
        }

        function removeUrl(domain, index) {
            if (currentSearchUrls[domain]) {
                currentSearchUrls[domain].splice(index, 1);
                displaySearchUrls(currentSearchUrls);
            }
        }

        function addUrl(domain) {
            if (!currentSearchUrls[domain]) {
                currentSearchUrls[domain] = [];
            }
            currentSearchUrls[domain].push('https://' + domain + '/search?q={query}');
            displaySearchUrls(currentSearchUrls);
        }

        function removeDomain(domain) {
            delete currentSearchUrls[domain];
            displaySearchUrls(currentSearchUrls);
        }

        async function saveSearchUrls() {
            const siteType = document.getElementById('search-url-site-type').value;
            
            try {
                const response = await fetch(`/api/config/search-urls/${siteType}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({searchUrls: currentSearchUrls})
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showToast('æœç´¢URLé…ç½®ä¿å­˜æˆåŠŸ', 'success');
                } else {
                    showToast('ä¿å­˜å¤±è´¥: ' + data.error, 'error');
                }
            } catch (error) {
                showToast('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            showToast(message, 'error');
        }
        
        // æ˜¾ç¤ºæˆåŠŸä¿¡æ¯
        function showSuccess(message) {
            showToast(message, 'success');
        }
        
        // è®¿é—®ç½‘ç«™
        function visitSite(domain) {
            // æ£€æŸ¥æ˜¯å¦éœ€è¦æ·»åŠ wwwå‰ç¼€
            const checkbox = document.getElementById(`www-prefix-${domain.replace(/\./g, '-')}`);
            const useWww = checkbox ? checkbox.checked : false;
            
            let actualDomain = domain;
            if (useWww && !domain.startsWith('www.')) {
                actualDomain = `www.${domain}`;
            }
            
            const url = actualDomain.startsWith('http') ? actualDomain : `https://${actualDomain}`;
            window.open(url, '_blank');
        }
        
        // åˆ‡æ¢wwwå‰ç¼€è®¾ç½®ï¼ˆä»…å‰ç«¯ï¼Œä¸ä¿å­˜ï¼‰
        function toggleWwwPrefix(domain, siteType) {
            // è¿™é‡Œä¸éœ€è¦åšä»»ä½•å¤„ç†ï¼Œåªæ˜¯è®©ç”¨æˆ·çŸ¥é“è®¾ç½®å·²æ”¹å˜
            console.log(`åˆ‡æ¢ ${domain} çš„wwwå‰ç¼€è®¾ç½®`);
        }
        
        // ç¼–è¾‘ç½‘ç«™
        async function editSite(domain, siteType) {
            console.log(`å¼€å§‹ç¼–è¾‘ç½‘ç«™: ${domain}, ç±»å‹: ${siteType}`);
            
            // è·å–å½“å‰ç½‘ç«™çš„æœç´¢URL
            const currentUrls = await getCurrentSearchUrls(domain, siteType);
            console.log(`è·å–åˆ°çš„URL:`, currentUrls);
            
            // åˆ›å»ºç¼–è¾‘å¯¹è¯æ¡†
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>ç¼–è¾‘ç½‘ç«™: ${domain}</h3>
                        <button class="close-btn" onclick="closeEditModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>åŸŸå</label>
                            <input type="text" id="edit-domain" value="${domain}" readonly>
                        </div>
                        <div class="form-group">
                            <label>æœç´¢URLæ¨¡æ¿ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                            <textarea id="edit-search-urls" rows="5" placeholder="ä¾‹å¦‚: https://example.com/search?q={query}">${currentUrls.join('\n')}</textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary" onclick="saveEditSite('${siteType}')">ä¿å­˜</button>
                        <button class="btn btn-secondary" onclick="closeEditModal()">å–æ¶ˆ</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // è·å–å½“å‰ç½‘ç«™çš„æœç´¢URL
        async function getCurrentSearchUrls(domain, siteType) {
            try {
                const response = await fetch(`/api/config/sites/${siteType}/urls/${encodeURIComponent(domain)}`);
                const data = await response.json();
                
                if (response.ok) {
                    console.log(`è·å–åˆ° ${domain} çš„æœç´¢URL:`, data.searchUrls);
                    return data.searchUrls || [];
                } else {
                    console.warn('è·å–æœç´¢URLå¤±è´¥:', data.error);
                    return [];
                }
            } catch (error) {
                console.warn('è·å–æœç´¢URLå¤±è´¥:', error);
                return [];
            }
        }
        
        // å…³é—­ç¼–è¾‘å¯¹è¯æ¡†
        function closeEditModal() {
            const modal = document.querySelector('.modal');
            if (modal) {
                modal.remove();
            }
        }
        
        // ä¿å­˜ç¼–è¾‘çš„ç½‘ç«™
        async function saveEditSite(siteType) {
            const domain = document.getElementById('edit-domain').value.trim();
            const searchUrlsText = document.getElementById('edit-search-urls').value.trim();
            
            if (!domain) {
                showToast('åŸŸåä¸èƒ½ä¸ºç©º', 'error');
                return;
            }
            
            // è§£ææœç´¢URL
            const searchUrls = searchUrlsText.split('\n')
                .map(url => url.trim())
                .filter(url => url.length > 0);
            
            try {
                const response = await fetch(`/api/config/sites/${siteType}/edit`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        domain: domain,
                        searchUrls: searchUrls
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showToast('ç½‘ç«™ç¼–è¾‘æˆåŠŸ', 'success');
                    closeEditModal();
                    loadSites(); // é‡æ–°åŠ è½½ç½‘ç«™åˆ—è¡¨
                } else {
                    showToast('ç¼–è¾‘å¤±è´¥: ' + data.error, 'error');
                }
            } catch (error) {
                showToast('ç¼–è¾‘å¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // æ·»åŠ è‡³é»‘åå•
        async function addToBlacklist(domain) {
            if (confirm(`ç¡®å®šè¦å°† ${domain} æ·»åŠ åˆ°é»‘åå•å—ï¼Ÿ`)) {
                try {
                    const response = await fetch('/api/config/blacklist', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({domain: domain, action: 'add'})
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        showToast(`å·²å°† ${domain} æ·»åŠ åˆ°é»‘åå•`, 'success');
                        loadSites(); // é‡æ–°åŠ è½½ç½‘ç«™åˆ—è¡¨
                    } else {
                        showToast('æ·»åŠ å¤±è´¥: ' + data.error, 'error');
                    }
                } catch (error) {
                    showToast('æ·»åŠ å¤±è´¥: ' + error.message, 'error');
                }
            }
        }
        
        // URLè§£æå‡½æ•°
        function parseUrl(url, domainId, searchUrlsId) {
            try {
                const urlObj = new URL(url);
                const domain = urlObj.hostname;
                
                // è®¾ç½®åŸŸå
                document.getElementById(domainId).value = domain;
                
                // è§£ææœç´¢å‚æ•°ï¼Œå°†æŸ¥è¯¢å‚æ•°æ›¿æ¢ä¸º{query}
                let searchUrl = urlObj.origin + urlObj.pathname;
                const params = new URLSearchParams(urlObj.search);
                
                // å¸¸è§çš„æœç´¢å‚æ•°å
                const searchParams = ['q', 'query', 'keyword', 'search', 'wd', 'w', 'k', 'term', 'text'];
                let hasSearchParam = false;
                
                for (const [key, value] of params.entries()) {
                    if (searchParams.includes(key.toLowerCase())) {
                        searchUrl += (searchUrl.includes('?') ? '&' : '?') + key + '={query}';
                        hasSearchParam = true;
                    } else {
                        searchUrl += (searchUrl.includes('?') ? '&' : '?') + key + '=' + value;
                    }
                }
                
                // å¦‚æœæ²¡æœ‰æ‰¾åˆ°æœç´¢å‚æ•°ï¼Œå°è¯•ä»è·¯å¾„ä¸­æå–
                if (!hasSearchParam) {
                    const pathParts = urlObj.pathname.split('/');
                    for (let i = 0; i < pathParts.length; i++) {
                        if (searchParams.includes(pathParts[i].toLowerCase())) {
                            pathParts[i] = '{query}';
                            searchUrl = urlObj.origin + pathParts.join('/');
                            if (urlObj.search) {
                                searchUrl += urlObj.search;
                            }
                            break;
                        }
                    }
                }
                
                // è®¾ç½®æœç´¢URL
                document.getElementById(searchUrlsId).value = searchUrl;
                
                showToast('é“¾æ¥è§£ææˆåŠŸï¼', 'success');
            } catch (error) {
                showToast('é“¾æ¥è§£æå¤±è´¥: ' + error.message, 'error');
            }
        }
        
        // ç½‘é¡µæœç´¢URLè§£æ
        function parseWebUrl() {
            const url = document.getElementById('web-copy-url').value.trim();
            if (!url) {
                showToast('è¯·è¾“å…¥æœç´¢é“¾æ¥', 'error');
                return;
            }
            parseUrl(url, 'web-domain', 'web-search-urls');
        }
        
        // å›¾ç‰‡æœç´¢URLè§£æ
        function parseImageUrl() {
            const url = document.getElementById('image-copy-url').value.trim();
            if (!url) {
                showToast('è¯·è¾“å…¥æœç´¢é“¾æ¥', 'error');
                return;
            }
            parseUrl(url, 'image-domain', 'image-search-urls');
        }
        
        // è§†é¢‘æœç´¢URLè§£æ
        function parseVideoUrl() {
            const url = document.getElementById('video-copy-url').value.trim();
            if (!url) {
                showToast('è¯·è¾“å…¥æœç´¢é“¾æ¥', 'error');
                return;
            }
            parseUrl(url, 'video-domain', 'video-search-urls');
        }
        
        // èµ„æºæœç´¢URLè§£æ
        function parseResourceUrl() {
            const url = document.getElementById('resource-copy-url').value.trim();
            if (!url) {
                showToast('è¯·è¾“å…¥æœç´¢é“¾æ¥', 'error');
                return;
            }
            parseUrl(url, 'resource-domain', 'resource-search-urls');
        }
    </script>
</body>
</html>